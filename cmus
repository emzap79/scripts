#!/bin/bash
dirPod="$HOME/Podcasts/Music"
dirPlug="$HOME/.cmus/plugins"
plugMag="$HOME/.cmus/pluglist"
playlPodc="$HOME/.cmus/plPodcasts.pl"

#Starting Cmus in Demon Mode#{{{
if ! screen -r -D cmus >/dev/null ; then
#}}}
# Plugins & Playlists#{{{
	# # Removing old Podcast-Playlists#{{{
	if [[ ! -d "$HOME/.cmus/podcasts" ]]; then mkdir -p $HOME/.cmus/podcasts; fi
	rm $HOME/.cmus/podcasts/plPod*.pl $HOME/.cmus/plPod*.pl
#}}}
	# # Generating Plugins#{{{
	if [ ! -e "$plugMag" ]; then echo '#!/bin/bash' | tee "$plugMag"; fi
	sed -i '2,$ d' "$plugMag"
	for f in $(find "$dirPlug" -type f | egrep -v '~$'); 
	do
		echo "$f \"\$@\" &" | tee -a "$plugMag"
	done
	echo "exit 0" | tee -a "$plugMag"
#}}}
	# # Removing empty dirs and mediaartlocals#{{{
	find $dirPod -type f -regextype egrep -iregex '.*(jpg|jpeg)'\
	-exec rm -v {} \;
	find "$dirPod" -depth -type d -empty -exec rmdir -- {} \;
#}}}
	# # Creating Playlists#{{{
	for f in $(find $dirPod -maxdepth 2 -mindepth 2 -type d);
	do
		nmShow=$(echo "$f" | sed 's/.*\/\([^/]*\)$/\1/g')
		nmGenre=$(echo "$f" | sed 's/.*\/\([^/]*\)\/[^/]*$/\1/g')
		nmDate=$(ls -ltr --time-style=long-iso $f/* | awk '{print $6}' | tail -n1)
		ls $f/* | tee -a $HOME/.cmus/plPod_"$nmGenre".pl
		ls $f/* | tee $HOME/.cmus/podcasts/plPod_"$nmGenre"_"$nmDate"_"$nmShow".pl
	done
#}}}
	# # Playlist of Podcasts#{{{
	echo "Creating Podcast-Playlist ..."
	find $dirPod -maxdepth 3 -mindepth 2 -type f -regextype egrep -iregex \
	'.*(2sf|2sflib|3ga|4mp|669|6cm|8cm|8med|8svx|a2m|a52|aa|aa3|aac|aax|ab|abc|abm|ac3|acd|acd-bak|acd-zip|acm|acp|act|adg|adt|adts|adv|afc|agm|agr|ahx|aif|aifc|aiff|aimppl|ais|akp|al|alac|alaw|alc|all|als|amf|amr|ams|ams|amxd|amz|aob|ape|apf|apl|aria|ariax|asd|ase|at3|atrac|au|au|aud|aup|avastsounds|avr|awb|ay|b4s|band|bap|bcs|bdd|bidule|bonk|box|brstm|bun|bwf|bwg|bww|c01|caf|caff|cda|cdda|cdlx|cdo|cdr|cel|cfa|cfxr|cgrp|cidb|ckb|ckf|cmf|conform|copy|cpr|cpt|csh|cts|cwb|cwp|d00|d01|dcf|dcm|dct|ddt|dewf|df2|dfc|dff|dig|dig|djr|dls|dm|dmc|dmf|dmsa|dmse|dra|drg|ds|ds2|dsf|dsm|dsp|dss|dtm|dts|dtshd|dvf|dwa|dwd|ear|efa|efe|efk|efq|efs|efv|emd|emp|emx|emy|esps|evr|expressionmap|f2r|f32|f3r|f4a|f64|far|fda|fdp|fev|fff|flac|fla|flp|fls|frg|fsb|fsm|ftm|fzb|fzf|fzv|g721|g723|g726|gbproj|gbs|gig|gio|gio|gm|gp5|gpbank|gpk|gpx|gro|groove|gsm|gsm|h0|hdp|hma|hmi|hsb|iaa|ics|iff|igp|igr|imf|imp|ins|ins|isma|it|iti|itls|its|jam|jam|jo|jo-7z|k25|k26|kar|kfn|kin|kit|kmp|koz|koz|kpl|krz|ksc|ksf|ksm|kt2|kt3|ktp|l|la|lof|logic|lqt|lso|lvp|lwv|m1a|m3u|m3u8|m4a|m4b|m4p|m4r|ma1|mbr|mdc|mdl|med|mgv|mid|midi|mini2sf|minincsf|miniusf|mka|mlp|mmf|mmm|mmp|mo3|mod|mogg|mp1|mp2|mp3|mp_|mpa|mpc|mpdp|mpga|mpu|mscx|mscz|msv|mt2|mt9|mte|mtf|mti|mtm|mtp|mts|mu3|mui|mus|mus|mus|musa|mux|mux|muz|mws|mx3|mx4|mx5|mx5template|mxl|mxmf|myr|mzp|nap|nbs|ncw|nkb|nkc|nki|nkm|nks|nkx|nml|note|npl|nra|nrt|nsa|nsf|nst|ntn|nvf|nwc|obw|odm|ofr|oga|ogg|okt|oma|omf|omg|omx|opus|orc|ots|ove|ovw|ovw|pac|pandora|pat|pbf|pca|pcast|pcg|pcm|pd|peak|pek|pho|phy|pk|pkf|pla|pls|plst|ply|pna|pno|ppc|ppcx|prg|prg|psf|psm|psy|ptcop|ptf|ptm|pts|ptx|pvc|qcp|r|r1m|ra|ram|raw|rax|rbs|rbs|rcy|record|rex|rfl|rgrp|rip|rmf|rmi|rmj|rmm|rmx|rng|rns|rol|rsn|rso|rta|rti|rtm|rts|rvx|rx2|s3i|s3m|s3z|saf|sam|sap|sb|sbg|sbi|sbk|sc2|scs11|sd|sd|sd2|sd2f|sdat|sdii|sds|sdt|sdx|seg|seq|ses|sesx|sf|sf2|sfap0|sfk|sfl|sfpack|sfs|sgp|shn|sib|sid|slp|slx|sma|smf|smp|smp|snd|snd|snd|sng|sng|sns|snsf|sou|sph|sppack|sprg|spx|sseq|sseq|ssnd|stap|stm|stx|sty|sty|svd|svx|sw|swa|swav|sxt|syh|syn|syn|syw|syx|tak|tak|td0|tfmx|tg|thx|tm2|tm8|tmc|toc|trak|tsp|tta|tun|txw|u|u8|uax|ub|ulaw|ult|ulw|uni|usf|usflib|ust|uw|uwf|v2m|vag|val|vap|vb|vc3|vdj|vgm|vgz|vlc|vmd|vmf|vmf|vmo|voc|voi|vox|voxal|vpl|vpm|vqf|vrf|vsq|vtx|vyf|w01|w64|wav|wav|wave|wax|wem|wfb|wfd|wfm|wfp|wma|wow|wpk|wpp|wproj|wrk|wtpl|wtpt|wus|wut|wv|wvc|wve|wwu|wyz|xa|xa|xfs|xi|xm|xmf|xmi|xmz|xp|xrns|xsb|xsp|xspf|xt|xwb|ym|yookoo|zpa|zpl|zvd|zvr)$' -fprint $playlPodc
#}}}
#}}}
	#Starting Cmus#{{{
	chmod -R 775 "$HOME/.cmus/plug"*

	#Executing Scripts
	/bin/bash "$HOME/bin/cmusLastEnQ"
	/bin/bash "$HOME/bin/cmusPlayRandom"

#Starting in Screen-Mode
	cd $HOME/.cmus
	screen -S cmus /usr/bin/cmus "$@"

	#Setting Colorscheme
	# cmus-remote -C "colorscheme colorGreen"
	# cmus-remote -q $playlPodc
#}}}
fi
