#!/bin/bash
################################################################################################
################### MP3-Version 2 ##############################################################
################################################################################################
EXT=${1##*.}

yearv2=`id3v2 -l "$1" | grep TYER | cut -d ':' -f 2 | awk 'FNR == 1{print}' | sed '/^ /s/^ *//;s/[\/<>:"?*|]/_/g'`
artistv2=`id3v2 -l "$1" | grep TPE1 | cut -d ':' -f 2 | awk 'FNR == 1{print}' | sed '/^ /s/^ *//;s/\(\< \)/\ \U\1/g;s/^\**.*\*//g' | awk 'FNR == 1 {print}'`
albartistv2=`id3v2 -l "$1" | grep TPE1 | awk 'FNR == 1 {print}' | cut -d '=' -f 2 | sed '/^ /s/^ *//;/^The/s/\([^ ]*\) *\([^ ]*.*\)/\2, \1 /g;s/[ (][Ff]eat[\. ]*.*$//;s/[ (][Ff]t[\. ]*.*$//;s/[ ,(][ &] *.*$//;s/ [Vv]s\.*.*$//;s/\ \(\<.\)/\ \U\1/g;s/ *$//;s/^\**.*\*//g'`
trackv2=`id3v2 -l "$1" | grep TRCK | cut -d ':' -f 2 | awk 'FNR == 1{print}' | sed '/^ /s/^ *//;s/^\([0-9]\)$/0\1/g;s/[\/<>:"?*|]/_/g'`
titlev2=`id3v2 -l "$1" | grep TIT2 | cut -d ':' -f 2 | awk 'FNR == 1{print}' | sed '/^ /s/^ *//g;s/\ \(\<.\)/\ \U\1/g;s/\([^0-9]\)\([0-9]\+\).*//g;s/ *$//g'`
albumv2=`id3v2 -l "$1" | grep TALB | cut -d ':' -f 2 | awk 'FNR == 1{print}' | sed '/^ /s/^ *//;s/[/<>:"?*|]\./_/g;s/\ \(\<.\)/\ \U\1/g'`
albartistv2=`id3v2 -l "$1" | grep TPE2 | cut -d ':' -f 2 | awk 'FNR == 1{print}' | sed '/^ /s/^ *//;s/[\/<>:"?*|]/_/g;s/[ (][Ff]eat[\. ]*.*$//;s/[ (][Ff]t[\. ]*.*$//;s/ [Vv]s\.*.*$//;s/\(\<.\)/\ \U\1/g'`

################################################################################################
################### MP3-Version 1 ##############################################################
################################################################################################
year=`lltag -S "$1" | grep -i date\= | cut -d '=' -f 2 | awk 'FNR == 1{print}' | sed '/^ /s/^ *//;s/[\/<>:"?*|]/_/g'`
artist=`lltag -S "$1" | grep -i artist\= | cut -d '=' -f 2 | awk 'FNR == 1{print}' | sed '/^ /s/^ *//;s/[\/<>:"?*|]/_/g;s/\(\<.\)/\ \U\1/g;s/^\**.*\*//g' | awk 'FNR == 1 {print}'`
track=`lltag -S "$1" | grep -i number\= | cut -d '=' -f 2 | awk 'FNR == 1{print}' | sed '/^ /s/^ *//;s/^\([0-9]\)$/0\1/g;s/[\/<>:"?*|]/_/g'`
title=`lltag -S "$1" | grep -i title\= | cut -d '=' -f 2 | awk 'FNR == 1{print}' | sed -e '/^ /s/^ *//;s/[\/<>:"?*|]/_/g;s/\ \(\<.\)/\ \U\1/g;s/\([^0-9]\)\([0-9]\+\).*//g;s/ *$//g'`
album=`lltag -S "$1" | grep -i album\= | cut -d '=' -f 2 | awk 'FNR == 1{print}' | sed '/^ /s/^ *//;s/[\/<>:"?*|]\./_/g;s/\ \(\<.\)/\ \U\1/g'`
albartist=`lltag -S "$1" | grep -i albumartist\= | cut -d '=' -f 2 | awk 'FNR == 1{print}' | sed '/^ /s/^ *//;s/ /\./g;s/[\/<>:"?*|]/_/g;s/[ (][Ff]eat[\. ]*.*$//;s/[ (][Ff]t[\. ]*.*$//;s/ [Vv]s\.*.*$//;s/\(\<.\)/\ \U\1/g'`

################################################################################################
################################################################################################
case $EXT in
    txt|jpg|jpeg|gif|png)
        ;;
    wav)
        pacpl --quiet --normalize --to mp3 "$1"
        ;;
    wma|acc|m4a|wmv)
        pacpl --quiet --to mp3 "$1"
        ;;
    ogg)
        ;;
    mp3)
        echo `basename "$1"`
        id3v2 --TPE1 "$artistv2" --TIT2 "$titlev2" "$1"
        ;;
esac
